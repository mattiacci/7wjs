import SevenWonders from './SevenWonders.js';

const WONDERS = [{"name":"Alexandria","side":"A"},{"name":"Ephesos","side":"A"},{"name":"Halikarnassos","side":"A"},{"name":"Olympia","side":"A"}];
const CARDS = [[[{"age":1,"minPlayers":2,"name":"Altar"},{"age":1,"minPlayers":3,"name":"Baths"},{"age":1,"minPlayers":4,"name":"Guard Tower"},{"age":1,"minPlayers":2,"name":"Apothecary"},{"age":1,"minPlayers":3,"name":"East Trading Post"},{"age":1,"minPlayers":3,"name":"Clay Pool"},{"age":1,"minPlayers":2,"name":"Stockade"}],[{"age":1,"minPlayers":2,"name":"Loom"},{"age":1,"minPlayers":4,"name":"Lumber Yard"},{"age":1,"minPlayers":2,"name":"Workshop"},{"age":1,"minPlayers":3,"name":"Ore Vein"},{"age":1,"minPlayers":4,"name":"Scriptorium"},{"age":1,"minPlayers":4,"name":"Excavation"},{"age":1,"minPlayers":3,"name":"Stone Pit"}],[{"age":1,"minPlayers":2,"name":"West Trading Post"},{"age":1,"minPlayers":2,"name":"Barracks"},{"age":1,"minPlayers":2,"name":"Scriptorium"},{"age":1,"minPlayers":2,"name":"Glassworks"},{"age":1,"minPlayers":2,"name":"Clay Pit"},{"age":1,"minPlayers":2,"name":"Timber Yard"},{"age":1,"minPlayers":2,"name":"Marketplace"}],[{"age":1,"minPlayers":4,"name":"Tavern"},{"age":1,"minPlayers":3,"name":"Lumber Yard"},{"age":1,"minPlayers":2,"name":"Theater"},{"age":1,"minPlayers":3,"name":"Guard Tower"},{"age":1,"minPlayers":4,"name":"Ore Vein"},{"age":1,"minPlayers":2,"name":"Press"},{"age":1,"minPlayers":4,"name":"Pawnshop"}]],[[{"age":2,"minPlayers":3,"name":"Vineyard"},{"age":2,"minPlayers":3,"name":"Walls"},{"age":2,"minPlayers":4,"name":"Bazar"},{"age":2,"minPlayers":2,"name":"Archery Range"},{"age":2,"minPlayers":2,"name":"Sawmill"},{"age":2,"minPlayers":2,"name":"Dispensary"},{"age":2,"minPlayers":3,"name":"Loom"}],[{"age":2,"minPlayers":2,"name":"Laboratory"},{"age":2,"minPlayers":2,"name":"Foundry"},{"age":2,"minPlayers":2,"name":"Brickyard"},{"age":2,"minPlayers":2,"name":"Stables"},{"age":2,"minPlayers":4,"name":"Brickyard"},{"age":2,"minPlayers":3,"name":"Press"},{"age":2,"minPlayers":3,"name":"School"}],[{"age":2,"minPlayers":2,"name":"Courthouse"},{"age":2,"minPlayers":4,"name":"Sawmill"},{"age":2,"minPlayers":3,"name":"Aquaduct"},{"age":2,"minPlayers":4,"name":"Dispensary"},{"age":2,"minPlayers":4,"name":"Training Ground"},{"age":2,"minPlayers":2,"name":"Caravansery"},{"age":2,"minPlayers":4,"name":"Foundry"}],[{"age":2,"minPlayers":2,"name":"Statue"},{"age":2,"minPlayers":2,"name":"Quarry"},{"age":2,"minPlayers":2,"name":"Forum"},{"age":2,"minPlayers":2,"name":"Temple"},{"age":2,"minPlayers":4,"name":"Quarry"},{"age":2,"minPlayers":2,"name":"Library"},{"age":2,"minPlayers":3,"name":"Glassworks"}]],[[{"age":3,"minPlayers":2,"name":"Senate"},{"age":3,"minPlayers":3,"name":"Town Hall"},{"age":3,"minPlayers":0,"name":"Builders Guild"},{"age":3,"minPlayers":4,"name":"Gardens"},{"age":3,"minPlayers":3,"name":"Arsenal"},{"age":3,"minPlayers":2,"name":"Lodge"},{"age":3,"minPlayers":0,"name":"Spies Guild"}],[{"age":3,"minPlayers":3,"name":"Fortifications"},{"age":3,"minPlayers":0,"name":"Shipowners Guild"},{"age":3,"minPlayers":2,"name":"University"},{"age":3,"minPlayers":3,"name":"Palace"},{"age":3,"minPlayers":0,"name":"Philosophers Guild"},{"age":3,"minPlayers":4,"name":"Haven"},{"age":3,"minPlayers":2,"name":"Haven"}],[{"age":3,"minPlayers":0,"name":"Strategists Guild"},{"age":3,"minPlayers":2,"name":"Observatory"},{"age":3,"minPlayers":4,"name":"Chamber Of Commerce"},{"age":3,"minPlayers":4,"name":"Circus"},{"age":3,"minPlayers":2,"name":"Gardens"},{"age":3,"minPlayers":2,"name":"Pantheon"},{"age":3,"minPlayers":2,"name":"Arena"}],[{"age":3,"minPlayers":2,"name":"Lighthouse"},{"age":3,"minPlayers":2,"name":"Siege Workshop"},{"age":3,"minPlayers":4,"name":"Arsenal"},{"age":3,"minPlayers":4,"name":"University"},{"age":3,"minPlayers":0,"name":"Scientists Guild"},{"age":3,"minPlayers":3,"name":"Academy"},{"age":3,"minPlayers":3,"name":"Study"}]]];
const STATES = [];
STATES[0] = {"game": {"age": 0}, "players": [{"battleTokens": [], "built": [], "cardsInHand": [{"age": 1, "cost": [], "free": true, "minPlayers": 2, "name": "Altar", "tooltip": "Yields 2 victory points.", "type": 8, "unplayable": false}, {"age": 1, "cost": [[1]], "free": false, "minPlayers": 3, "name": "Baths", "tooltip": "Yields 3 victory points.", "type": 8, "unplayable": true}, {"age": 1, "cost": [[0]], "free": false, "minPlayers": 4, "name": "Guard Tower", "tooltip": "Provides 1 unit of military strength.", "type": 4, "unplayable": true}, {"age": 1, "cost": [[5]], "free": false, "minPlayers": 2, "name": "Apothecary", "tooltip": "Enhances academics.", "type": 5, "unplayable": true}, {"age": 1, "cost": [], "free": true, "minPlayers": 3, "name": "East Trading Post", "tooltip": "Provides discounted resource trade with eastern neighbour.", "type": 2, "unplayable": false}, {"age": 1, "cost": [], "free": true, "minPlayers": 3, "name": "Clay Pool", "tooltip": "Produces clay.", "type": 0, "unplayable": false}, {"age": 1, "cost": [[2]], "free": false, "minPlayers": 2, "name": "Stockade", "tooltip": "Provides 1 unit of military strength.", "type": 4, "unplayable": false}], "gold": 3, "id": 0, "name": "0", "playable": true, "resources": {"east": {"multi": [], "single": {"0": 0, "1": 0, "2": 1, "3": 0, "4": 0, "5": 0, "6": 0}}, "multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 1, "5": 0, "6": 0}, "west": {"multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 1}}}, "score": 1, "waiting": false, "wonder": {"built": [], "isLast": false, "name": "Alexandria", "side": "A", "stageCount": 6}}, {"battleTokens": [], "built": [], "gold": 3, "id": 1, "name": "1", "playable": false, "resources": {"east": {"multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 1, "5": 0, "6": 0}}, "multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 1}, "west": {"multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 1, "6": 0}}}, "score": 1, "waiting": false, "wonder": {"built": [], "isLast": false, "name": "Ephesos", "side": "A", "stageCount": 6}}, {"battleTokens": [], "built": [], "gold": 3, "id": 2, "name": "2", "playable": false, "resources": {"east": {"multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 1}}, "multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 1, "6": 0}, "west": {"multi": [], "single": {"0": 0, "1": 0, "2": 1, "3": 0, "4": 0, "5": 0, "6": 0}}}, "score": 1, "waiting": false, "wonder": {"built": [], "isLast": false, "name": "Halikarnassos", "side": "A", "stageCount": 6}}, {"battleTokens": [], "built": [], "gold": 3, "id": 3, "name": "3", "playable": false, "resources": {"east": {"multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 1, "6": 0}}, "multi": [], "single": {"0": 0, "1": 0, "2": 1, "3": 0, "4": 0, "5": 0, "6": 0}, "west": {"multi": [], "single": {"0": 0, "1": 0, "2": 0, "3": 0, "4": 1, "5": 0, "6": 0}}}, "score": 1, "waiting": false, "wonder": {"built": [], "isLast": false, "name": "Olympia", "side": "A", "stageCount": 6}}]};

it('starts game and passes state and actions only to local player', () => {
  const playerInterfaces = [];
  const endGameHandler = jest.fn();
  const stateUpdateHandler = jest.fn();
  const remoteStateUpdateHandler = jest.fn();
  const turnsRef = [];
  playerInterfaces.push(new SevenWonders.PlayerInterface(
      stateUpdateHandler, turnsRef, 0, '0', true));
  for (let i = 1; i < 4; i++) {
    playerInterfaces.push(new SevenWonders.PlayerInterface(
        remoteStateUpdateHandler, turnsRef, i, String(i), false));
  }
  const game = new SevenWonders(playerInterfaces, WONDERS, CARDS, false, endGameHandler);
  expect(endGameHandler).not.toHaveBeenCalled();
  expect(remoteStateUpdateHandler).not.toHaveBeenCalled();
  expect(turnsRef).toHaveLength(0);
  expect(stateUpdateHandler).toHaveBeenCalledTimes(1);
  const state = stateUpdateHandler.mock.calls[0][0];
  expect(state).toEqual(STATES[0]);
  const actions = stateUpdateHandler.mock.calls[0][1];
  expect(actions).toHaveProperty('build');
  expect(actions).toHaveProperty('buildWonder');
  expect(actions).toHaveProperty('discard');
});
